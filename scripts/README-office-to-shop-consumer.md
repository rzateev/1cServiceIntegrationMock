# Office-To-Shop Consumer Test Script

–°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –æ—á–µ—Ä–µ–¥–∏ OfficeToShop —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è testAppE2e —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –∑–∞–º–µ—Ä–∞–º–∏ –≤—Ä–µ–º–µ–Ω–∏.

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç `office-to-shop-consumer.js` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —Ç–µ—Å—Ç–æ–≤–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é `testAppE2e`, –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏ —Å destination `OfficeToShop` –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–ó–∞–ø—É—â–µ–Ω–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞**: –°–Ω–∞—á–∞–ª–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω `e2e-test.js` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. **–ê–∫—Ç–∏–≤–Ω—ã–π Docker Compose**: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å mock-bus –∏ artemis –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã
3. **Node.js –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω amqp10 –∏ –¥—Ä—É–≥–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫
```bash
node scripts/office-to-shop-consumer.js
```

### –° –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
MOCK_API_URL=http://localhost:9090 AMQP_HOST=localhost node scripts/office-to-shop-consumer.js
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –æ–±—ä–µ–∫—Ç–µ `test_config`:

```javascript
const test_config = {
  applicationName: 'testAppE2e',        // –ò–º—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  processName: 'testProcessE2e',        // –ò–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞
  channelName: 'e2eOutQueue',           // –ò–º—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ –∫–∞–Ω–∞–ª–∞
  destination: 'OfficeToShop',          // Destination –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è
  maxMessages: 1000,                    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
  timeoutMs: 60000,                     // –¢–∞–π–º–∞—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
  batchReportSize: 10                   // –ß–∞—Å—Ç–æ—Ç–∞ –æ—Ç—á–µ—Ç–æ–≤ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ
};
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é testAppE2e
- **OIDC –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ runtime-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** –∫–∞–Ω–∞–ª–æ–≤ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏** —á–µ—Ä–µ–∑ Jolokia API –¥–æ –∏ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞
- **–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π** –∏–∑ AMQP –æ—á–µ—Ä–µ–¥–∏ —Å acknowledge
- **–î–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—Ä—ã –≤—Ä–µ–º–µ–Ω–∏** –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

### –ó–∞–º–µ—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –û–±—â–µ–µ –≤—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è (—Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ/–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ/—Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
- –í—Ä–µ–º—è –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –∏ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –¥–≤–∞ —Ñ–∞–π–ª–∞:
- `office-to-shop-results-{timestamp}.json` - –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `office-to-shop-messages-{timestamp}.json` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

## –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
üöÄ –ó–ê–ü–£–°–ö –¢–ï–°–¢–ê –ü–û–õ–£–ß–ï–ù–ò–Ø –°–û–û–ë–©–ï–ù–ò–ô –ò–ó –û–ß–ï–†–ï–î–ò OfficeToShop
üéØ –¶–µ–ª—å: –ø–æ–ª—É—á–∏—Ç—å –¥–æ 1000 —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –æ—á–µ—Ä–µ–¥–∏ "Office"

=== –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é ===
–ü–æ–∏—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è "testAppE2e"...
‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ: ID=507f1f77bcf86cd799439011, clientSecret —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
–ü–æ–ª—É—á–µ–Ω–∏–µ id_token —á–µ—Ä–µ–∑ OIDC...
‚úÖ id_token –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ
–ü—Ä–æ–≤–µ—Ä–∫–∞ runtime-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–∞–Ω–∞–ª–æ–≤...
‚úÖ –ö–∞–Ω–∞–ª "OfficeToShop" –Ω–∞–π–¥–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω

üìä –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—á–µ—Ä–µ–¥–∏ "OfficeToShop"...
üìà –°–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥–∏ "OfficeToShop": 150

=== –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –æ—á–µ—Ä–µ–¥–∏ OfficeToShop ("OfficeToShop") ===
–ú–∞–∫—Å–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π: 1000
–¢–∞–π–º–∞—É—Ç: 60000 –º—Å
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ AMQP-–±—Ä–æ–∫–µ—Ä—É
‚úÖ Receiver —Å–æ–∑–¥–∞–Ω –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ "OfficeToShop"
‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π (–º–∞–∫—Å–∏–º—É–º 60 —Å–µ–∫—É–Ω–¥)...
üéØ –ü–æ–ª—É—á–µ–Ω–æ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  üìà –ü–æ–ª—É—á–µ–Ω–æ: 10 —Å–æ–æ–±—â–µ–Ω–∏–π | –°–∫–æ—Ä–æ—Å—Ç—å: 125.50 —Å–æ–æ–±—â/—Å–µ–∫ | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 2–º—Å
  üìà –ü–æ–ª—É—á–µ–Ω–æ: 20 —Å–æ–æ–±—â–µ–Ω–∏–π | –°–∫–æ—Ä–æ—Å—Ç—å: 130.25 —Å–æ–æ–±—â/—Å–µ–∫ | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 1–º—Å
...
üèÅ –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π: 150
üîå Receiver –æ—Ç–∫–ª—é—á–µ–Ω
üîå –û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç AMQP-–±—Ä–æ–∫–µ—Ä–∞

=== üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–õ–£–ß–ï–ù–ò–Ø –°–û–û–ë–©–ï–ù–ò–ô ===
‚úÖ –í—Å–µ–≥–æ –ø–æ–ª—É—á–µ–Ω–æ: 150 —Å–æ–æ–±—â–µ–Ω–∏–π
‚ùå –û—à–∏–±–æ–∫: 0
‚è±Ô∏è  –û–±—â–µ–µ –≤—Ä–µ–º—è: 1250 –º—Å (1.25 —Å–µ–∫)
üöÄ –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: 120.00 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫
‚ö° –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 1.50 –º—Å
üìè –ú–∏–Ω. –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 1 –º—Å
üìè –ú–∞–∫—Å. –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 3 –º—Å
üìÖ –í—Ä–µ–º—è –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è: 1200 –º—Å

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏ OfficeToShop:
   –î–æ —Ç–µ—Å—Ç–∞: 150 —Å–æ–æ–±—â–µ–Ω–∏–π
   –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∞: 0 —Å–æ–æ–±—â–µ–Ω–∏–π
   –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∏–∑ –æ—á–µ—Ä–µ–¥–∏: 150 —Å–æ–æ–±—â–µ–Ω–∏–π

üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...
üìÑ –ö—Ä–∞—Ç–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ office-to-shop-results-1703123456789.json
üìã –î–µ—Ç–∞–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ office-to-shop-messages-1703123456789.json

‚úÖ –¢–ï–°–¢ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù!
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
```
‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "testAppE2e" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ e2e-test.js –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã.
```
**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–ø—É—Å—Ç–∏—Ç–µ `node scripts/e2e-test.js` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥–∏
```
üí° –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –±—ã–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
   ‚Ä¢ –û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞
   ‚Ä¢ –°–æ–æ–±—â–µ–Ω–∏—è –±—ã–ª–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
```
**–†–µ—à–µ–Ω–∏–µ**: –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π destination.

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ AMQP
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã –∏ –ø–æ—Ä—Ç 6698 –¥–æ—Å—Ç—É–ø–µ–Ω.

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏

–°–∫—Ä–∏–ø—Ç –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤–º–µ—Å—Ç–µ —Å:
- `e2e-test.js` - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- `performance-producer.js` - –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –î—Ä—É–≥–∏–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å OfficeToShop
# Модуль создания тестового приложения для 1С

## Описание

Модуль `СозданиеТестовогоПриложения.bsl` предоставляет функциональность для программного создания тестового приложения в mock-сервисе интеграции, аналогично кнопке "Создать тестовое приложение" в веб-интерфейсе.

## Основные возможности

- ✅ Создание тестового приложения с параметрами по умолчанию
- ✅ Создание приложения с пользовательскими параметрами
- ✅ Автоматическая очистка старых данных перед созданием
- ✅ Создание процесса и каналов для тестирования
- ✅ Обработка ошибок и возврат подробной информации
- ✅ Поддержка HTTP запросов к API mock-сервиса

## Структура создаваемого приложения

При создании тестового приложения автоматически создается:

1. **Приложение** - основная сущность с именем, описанием и секретными ключами
2. **Процесс** - `e1c::ТестовыйПроект::Основной::OfficeToShop`
3. **Каналы**:
   - `e2eOutOfficeToOffice` (outbound) → `OfficeToOffice`
   - `e2eInOfficeToOffice` (inbound) ← `OfficeToOffice`
   - `e2eOutOfficeToShop` (outbound) → `OfficeToShop`

## Использование

### Простое создание с параметрами по умолчанию

```bsl
// Подключаем модуль
МодульСоздания = Новый МодульСозданияТестовогоПриложения;

// Создаем приложение
Результат = МодульСоздания.СоздатьТестовоеПриложение("http://localhost:9090");

Если Результат.Успех Тогда
    Сообщить("Приложение создано: " + Результат.ДанныеПриложения.Имя);
Иначе
    Сообщить("Ошибка: " + Результат.Сообщение);
КонецЕсли;
```

### Создание с пользовательскими параметрами

```bsl
Результат = МодульСоздания.СоздатьТестовоеПриложение(
    "http://localhost:9090",                    // БазовыйURL
    "МоеПриложение",                           // ИмяПриложения
    "Мое тестовое приложение",                 // ОписаниеПриложения
    "мой-секретный-ключ"                       // ClientSecret
);
```

## Структура возвращаемого результата

```bsl
Результат = Новый Структура;
Результат.Вставить("Успех", Истина/Ложь);
Результат.Вставить("Сообщение", "Описание результата");
Результат.Вставить("ДанныеПриложения", Новый Структура);
Результат.ДанныеПриложения.Вставить("Имя", "testAppE2e");
Результат.ДанныеПриложения.Вставить("ID", "64f1234567890abcdef12345");
Результат.ДанныеПриложения.Вставить("ClientSecret", "68bdf9565056a16f21615505c3cae5a6");
Результат.ДанныеПриложения.Вставить("IDToken", "B0fKm9xmQNXZxkBOhkKCYndP2Ng0rV2Y29OYa76lEFUz");
Результат.ДанныеПриложения.Вставить("Описание", "Тестовое приложение для E2E-теста");
```

## Обработка ошибок

Модуль автоматически обрабатывает ошибки и возвращает подробную информацию:

```bsl
Если НЕ Результат.Успех Тогда
    // Логирование ошибки
    ЗаписатьЖурналРегистрации("СозданиеТестовогоПриложения", 
        УровеньЖурналаРегистрации.Ошибка, , , Результат.Сообщение);
    
    // Показать пользователю
    ПоказатьОшибку(, "Ошибка создания приложения:" + Символы.НСтр + Результат.Сообщение);
КонецЕсли;
```

## Интеграция с сервисами интеграции 1С

После создания приложения можно использовать полученные данные для настройки сервиса интеграции:

```bsl
// Создаем приложение
Результат = МодульСоздания.СоздатьТестовоеПриложение("http://localhost:9090");

Если Результат.Успех Тогда
    // Настраиваем сервис интеграции
    НастроитьСервисИнтеграции(
        Результат.ДанныеПриложения.Имя,           // Имя пользователя
        Результат.ДанныеПриложения.ClientSecret,  // Пароль
        Результат.ДанныеПриложения.IDToken        // ID Token для AMQP
    );
КонецЕсли;
```

## Примеры использования

### Создание нескольких приложений

```bsl
СписокИмен = Новый Массив;
СписокИмен.Добавить("Приложение1");
СписокИмен.Добавить("Приложение2");
СписокИмен.Добавить("Приложение3");

Для Каждого Имя Из СписокИмен Цикл
    Результат = МодульСоздания.СоздатьТестовоеПриложение(
        "http://localhost:9090",
        Имя,
        "Тестовое приложение " + Имя
    );
    
    Если Результат.Успех Тогда
        Сообщить("✓ " + Имя + " создано");
    Иначе
        Сообщить("✗ " + Имя + " ошибка: " + Результат.Сообщение);
    КонецЕсли;
КонецЦикла;
```

### Создание с повторными попытками

```bsl
МаксимальноеКоличествоПопыток = 3;
НомерПопытки = 1;

Пока НомерПопытки <= МаксимальноеКоличествоПопыток Цикл
    Результат = МодульСоздания.СоздатьТестовоеПриложение("http://localhost:9090");
    
    Если Результат.Успех Тогда
        Сообщить("Успешно с попытки " + НомерПопытки);
        Прервать;
    КонецЕсли;
    
    Если НомерПопытки < МаксимальноеКоличествоПопыток Тогда
        Приостановить(5); // Ждем 5 секунд
    КонецЕсли;
    
    НомерПопытки = НомерПопытки + 1;
КонецЦикла;
```

## Требования

- Платформа 1С:Предприятие 8.3.17 или выше
- Доступ к mock-сервису по HTTP
- Подключение к интернету для HTTP запросов

## Файлы модуля

- `СозданиеТестовогоПриложения.bsl` - основной модуль
- `СозданиеТестовогоПриложения.epf` - обработка с формой
- `ПримерСозданияТестовогоПриложения.bsl` - примеры использования

## Поддержка

При возникновении проблем:

1. Проверьте доступность mock-сервиса по адресу `http://localhost:9090`
2. Убедитесь, что все сервисы запущены (`docker-compose up -d`)
3. Проверьте логи mock-сервиса
4. Используйте веб-интерфейс для диагностики

## Лицензия

Модуль распространяется под лицензией MIT в рамках проекта 1C Service Integration Mock. 